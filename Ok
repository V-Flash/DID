from django.contrib.admin.models import LogEntry, ADDITION
from django.contrib.contenttypes.models import ContentType

def create_post(request):
    if request.method == 'POST':
        title = request.POST.get('title')
        text = request.POST.get('text')
        published_date = request.POST.get('published_date')

        # Create the Post object
        post = Post.objects.create(title=title, text=text, published_date=published_date, author=request.user)

        # Log the creation action
        LogEntry.objects.log_action(
            user_id=request.user.id,
            content_type_id=ContentType.objects.get_for_model(post).id,
            object_id=post.id,
            object_repr=str(post),
            action_flag=ADDITION,  # Use ADDITION for creating
        )

        return redirect('customadmin:posts')

    return render(request, 'create_post.html')
